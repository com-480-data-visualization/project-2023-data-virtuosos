<!doctype html>
<!--[if IE 7 ]>    <html lang="en-gb" class="isie ie7 oldie no-js"> <![endif]-->
<!--[if IE 8 ]>    <html lang="en-gb" class="isie ie8 oldie no-js"> <![endif]-->
<!--[if IE 9 ]>    <html lang="en-gb" class="isie ie9 no-js"> <![endif]-->
<!--[if (gt IE 9)|!(IE)]><!-->
<html lang="en-gb" class="no-js">
<!--<![endif]-->

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <!--[if lt IE 9]> 
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <![endif]-->
  <title>Visualization of Programming Languages</title>
  <meta name="description" content="">
  <meta name="author" content="WebThemez">
  <!--[if lt IE 9]>
        <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  <!--[if lte IE 8]>
		<script type="text/javascript" src="http://explorercanvas.googlecode.com/svn/trunk/excanvas.js"></script>
	<![endif]-->
  <link rel="stylesheet" href="css/bootstrap.min.css" />
  <link rel="stylesheet" type="text/css" href="css/isotope.css" media="screen" />
  <link rel="stylesheet" href="js/fancybox/jquery.fancybox.css" type="text/css" media="screen" />
  <link href="css/animate.css" rel="stylesheet" media="screen">
  <link href="flexslider/flexslider.css" rel="stylesheet" />
  <link href="js/owl-carousel/owl.carousel.css" rel="stylesheet">
  <link rel="stylesheet" href="css/styles.css" />
  <link href="font/css/font-awesome.min.css" rel="stylesheet">
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="js/ldavis.js"></script>
  <script src="js/queue.v1.min.js"></script>
  <script src="js/topojson.v1.min.js"></script>
  <link rel="stylesheet" type="text/css" href="css/lda.css">
  <script src="js/lda.js"></script>
  <!--[]>script for the table<![-->
  
</head>

<body>
  <header class="header">
    <div class="container">
      <nav class="navbar navbar-inverse" role="navigation">
        <div class="navbar-header">
          <button type="button" id="nav-toggle" class="navbar-toggle" data-toggle="collapse" data-target="#main-nav">
            <span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span>
            <span class="icon-bar"></span> </button>
          <a href="#" class="navbar-brand scroll-top logo  animated bounceInLeft"><b><i> </i></b></a>
        </div>
        <!--/.navbar-header-->
        <div id="main-nav" class="collapse navbar-collapse">
          <ul class="nav navbar-nav" id="mainNav">
            <li class="active" id="firstLink"><a href="#home" class="scroll-link">Home</a></li>
            <li><a href="#PlCloud" class="scroll-link">Language Cloud</a></li>
            <li><a href="#globalmap" class="scroll-link">Distribution Across Countries</a></li>
            <li><a href="#lda" class="scroll-link">LDAvis</a></li>
            <li><a href="#network" class="scroll-link">Network</a></li>
            <!--<li><a href="#hidden-table" class="scroll-link">Table of Details</a></li>-->
            
          </ul>
        </div>
        <!--/.navbar-collapse-->
      </nav>
      <!--/.navbar-->
    </div>
    <!--/.container-->
  </header>
  <!--/.header-->
  <div id="#top"></div>
  <section id="home">
    <div class="banner-container">
      <!-- Slider -->
      <div id="main-slider" class="flexslider">
        <ul class="slides">
          <li>
            <img src="images/slides/1.jpg" alt="" />
            <div class="flex-caption container">
              <h3>Programming Languages</h3>
              <p>A Visual Exploration of Key Features and Attributes</p>
            </div>
          </li>

        </ul>
      </div>
      <!-- end slider -->
    </div>

  </section>

  <section id="PlCloud">
    

    <div class="heading text-center">
      <!-- Heading -->
      <h2>Programming Languages Cloud</h2>
      <p>
        Effortlessly hover over each programming language to uncover additional information
      </p>
    </div>  

    <div class="heading text-center">

      <ul2 class="FontSize20">
        <li ><a onclick="toChangeBatch()" >Change to a new Batch: Explore another 30 programming languages </a></li>
      </ul2>
      <div class="content-wrapper">
        <div class="placeholder_style">
          <!-- Content will be displayed here when hovering over an element with a tooltip -->
        </div>
        <div class="content">
          <!-- content -->
        </div>
        <div id="content-display_plCloud" class="content-display">
          <!-- Content will be displayed here when hovering over an element with a tooltip -->
        </div>
      </div>
    </div>
    <script type="text/javascript" src="./js/TagCloud.min.js"></script>

    <script>
      let jsonDetailData;
      let selectedLanguages;
      class SeededRandom {
        constructor(seed) {
          this.seed = seed % 2147483647;
          if (this.seed <= 0) {
            this.seed += 2147483646;
          }
        }

        next() {
          return this.seed = this.seed * 16807 % 2147483647;
        }

        nextFloat() {
          return (this.next() - 1) / 2147483646;
        }
      }
      function getRandomInt(min, max, seed) {
        const randomGenerator = new SeededRandom(seed);
        min = Math.ceil(min);
        max = Math.floor(max);
        return Math.floor(Math.random() * (max - min + 1)) + min;
      }
      fetch("./data/details_data.json")
      .then(response => response.json())
      .then(data => {
        jsonDetailData = data;
        const numberOfItemsToPick = 30;
        selectedLanguages = [];

        // Ensure there are at least 100 items in the data
        if (jsonDetailData.length < numberOfItemsToPick) {
          console.error('Not enough items in the data to pick 100 random items');
          return;
        }

        while (selectedLanguages.length < numberOfItemsToPick) {
          // Get a random index within the data array
          const randomIndex = getRandomInt(0, jsonDetailData.length - 1);
          const item = jsonDetailData[randomIndex];

          // Check if the title is not already in the selectedLanguages array
          if (!selectedLanguages.includes(item)) {
            selectedLanguages.push(item);
          }
        }

        ready_for_pl_cloud(selectedLanguages)}
        )
      
      .catch(error => console.error('Error fetching JSON file:', error));
      
      let tc;
      function ready_for_pl_cloud(selectedLanguages) {
        
        tc = TagCloud('.content', selectedLanguages);
        //console.log(tc);
      }
      
      
      function displayContentMouseOver(e) {
        // Find the element where you want to display the content
        var contentDisplay = document.getElementById("content-display_plCloud");
        //console.log(e);
        for (let j = 0; j < 30; j++) {
            //console.log(e[j])
            //console.log(e,jsonDetailData[j].title)
            if (e==selectedLanguages[j].title){
              // Prepare the content to be displayed based on the input 'e'
              var content = "<strong class='PlCloudDetailStyleName'>Title: </strong><span class='PlCloudDetailStyleVal'>" + selectedLanguages[j].title + "<br></span>"
              +"<strong class='PlCloudDetailStyleName'>Country: </strong><span class='PlCloudDetailStyleVal'>" + selectedLanguages[j].country + "<br></span>" 
              +"<strong class='PlCloudDetailStyleName'>Appeared: </strong><span class='PlCloudDetailStyleVal'>" + selectedLanguages[j].appeared + "<br></span>"
              +"<strong class='PlCloudDetailStyleName'>Rank: </strong><span class='PlCloudDetailStyleVal'>" + selectedLanguages[j].rank + "<br></span>"
              +"<strong class='PlCloudDetailStyleName'>Number of Users: </strong><span class='PlCloudDetailStyleVal'>" + selectedLanguages[j].numberOfUsers + "<br></span>"
              +"<strong class='PlCloudDetailStyleName'>Type: </strong><span class='PlCloudDetailStyleVal'>" + selectedLanguages[j].type + "<br></span>";
              // Update the content display element with the new content
              contentDisplay.innerHTML = content;
              break;
            }
        }
        contentDisplay.classList.add('PlCloudDetailStyle');
        
      }
      function hideContentMouseOut() {
        // Find the element where you want to remove the displayed content
        var contentDisplay = document.getElementById("content-display_plCloud");

        // Clear the content of the content-display element
        contentDisplay.innerHTML = "";
        contentDisplay.classList.remove('PlCloudDetailStyle');
      }

      function ClickOnPLCloud(e) {

        for (let j = 0; j < 30; j++) {
          if (e==selectedLanguages[j].title){
              
                event.preventDefault();
                var targetSection = document.getElementById("tableId"+selectedLanguages[j].id);
                console.log(targetSection);
                if (targetSection) {
                  var targetPosition = targetSection.getBoundingClientRect().top + window.pageYOffset - window.innerHeight / 2 + targetSection.clientHeight / 2;

                  window.scrollTo({
                    top: targetPosition,
                    behavior: 'smooth'
                  });

                  // Add the flash class to the target section
                  targetSection.classList.add('flash');

                  // Remove the flash class after the animation is completed
                  setTimeout(function () {
                    targetSection.classList.remove('flash');
                  }, 3000); // The duration of the flash animation in milliseconds
                }
            
          }
        }
      }
    </script>
    <script>
        // switch style
        function toDefault() { document.body.classList.remove('light'); }
        function toLight() { document.body.classList.add('light'); }
        // add / remove tag
        function addTag() {
            if (!tc) return;
            texts.push('New');
            tc.update(texts);
        }
        function removeTag() {
            if (!tc) return;
            texts.pop();
            tc.update(texts);
        }
        var otherTcs = [];
        // create and destroy tagcloud
        function toCreate() {
            if (otherTcs.length >= 3) return;
            otherTcs.push(TagCloud('.content', texts));
        }
        function toDestroy() {
            var last = otherTcs[otherTcs.length - 1];
            if (!last) return;
            last.destroy();
            otherTcs.pop();
        }
        function toChangeBatch() {
            if (!tc) return;
            const numberOfItemsToPick = 30;
            selectedLanguages = [];

            // Ensure there are at least 100 items in the data
            if (jsonDetailData.length < numberOfItemsToPick) {
              console.error('Not enough items in the data to pick 100 random items');
              return;
            }

            while (selectedLanguages.length < numberOfItemsToPick) {
              // Get a random index within the data array
              const randomIndex = getRandomInt(0, jsonDetailData.length - 1);
              const item = jsonDetailData[randomIndex];

              // Check if the title is not already in the selectedLanguages array
              if (!selectedLanguages.includes(item)) {
                selectedLanguages.push(item);
              }
            }
            console.log("new batch:",selectedLanguages);
            tc.update(selectedLanguages);
        }
        
       
  
        // add and remove clickEvent
        function clickEventHandler(e) {
            if (e.target.className === 'tagcloud--item') {
                window.open(`https://www.google.com/search?q=${e.target.innerText}`, '_blank');
            }
        }
        function addClickEvent() {
            var rootEl = document.querySelector('.content');

            rootEl.addEventListener('click', clickEventHandler);
        }
        function removeClickEvent() {
            var rootEl = document.querySelector('.content');
            rootEl.removeEventListener('click', clickEventHandler);
        }
        
        
    </script>
  </div>
  </section>

  <div class="separator-line"></div>
  
  <section id="globalmap">
    <div class="heading text-center">
      <!-- Heading -->
      <h2>Distribution of Developers for Various Programming Languages Across Different Countries</h2>
      <p>
        Hover over each country to see details and click on a country to pin the list of details. Within these details, you can click on individual programming languages to learn more about the top3 most popular languages.<br>
        <br>
        A programming language may be developed collaboratively by multiple countries.
        <br>Therefore, we allocate a fraction, calculated as (1/the total number of countries contributing to its
        development), to each participating country.
      </p>
    </div>
    <div class="content-wrapper">
      <div class="placeholder_style">
        <!-- Content will be displayed here when hovering over an element with a tooltip -->
      </div>

      <div class="graph-center">
        <script src="js/d3.v4.min.js"></script>
        <script src="d3-tip.js"></script>
        <script src="js/globalmap_script.js"></script>
      </div>

      <div id="content-display_globalmap" class="content-display">
        <!-- Content will be displayed here when hovering over an element with a tooltip -->
      </div>
    </div>
  
  </section>






  <div class="separator-line"></div>

  <section id="lda" class="page-section colord">
    <script src="js/d3.v3.js"></script>
    <div class="container">
      <div class="heading text-center">
        <h2>LDA Visualization</h2>
        <p>
          Filter programming languages before selected year with left slider.<br>
          Choose language in right selection box.<br>
          Visualize keywords with LDA topic and relevance metric.
        </p>
      </div>
      <div class="row">
        <div class="col-md-6">
          <label for="year-slider">Select Year:</label>
          <input type="range" min="1950" max="2022" value="2022" class="slider" id="year-slider">
          <p>Year: <span id="year-display"></span></p>
        </div>
        <div class="col-md-6">
          <label for="language-select">Select Programming Language:</label>
          <select id="language-select" class="custom-select"></select>
        </div>
      </div>
      <div class="row">
        <div class="col-md-12">
          <div id="lda-vis"></div>
        </div>
      </div>
    </div>
  </section>

  <div class="separator-line"></div>

  <section id="network">
    <div class="heading text-center">
      <h2>Network Visualization</h2>
      <p>
        Show the language network of top 100 program languages.<br>
        Hover a node to see the language details.
      </p>
    </div>
    <style>
      .node {
        stroke: #fff;
        stroke-width: 1.5px;
      }

      .link {
        stroke: #c6c6c6;
        stroke-opacity: 0.6;
      }
    </style>
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
    <script src="https://d3js.org/topojson.v2.min.js"></script>
    <script src="https://d3js.org/queue.v1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3-tip/0.7.1/d3-tip.min.js"></script>


    <script>
      const nodesDataFile = './data/nodes_total.json';
      const edgesDataFile = './data/edges_total.json';
      // Generate a mock dataset for the network graph
      var nodes_data;
      var links_data;
      var types = ['pl', 'queryLanguage', 'textMarkup', 'os', 'dataNotation',
        'stylesheetLanguage', 'assembly', 'protocol', 'library', 'schema',
        'editor', 'application', 'framework',
        'hardwareDescriptionLanguage', 'contractLanguage',
        'characterEncoding', 'cloud', 'template', 'grammarLanguage',
        'xmlFormat', 'wikiMarkup'];

      d3.queue()
        .defer(d3.json, nodesDataFile)
        .defer(d3.json, edgesDataFile)
        .await((error, nodesData, edgesData) => {
          if (error) throw error;
          nodes_data = nodesData;
          links_data = edgesData;
          initNetworkGraph(nodesData, edgesData);
        });

      function initNetworkGraph(nodesData, edgesData) {
        // Set the dimensions and
        // margins of the graph
        var margin = { top: 10, right: 10, bottom: 10, left: 10 },
          width = 960 - margin.left - margin.right,
          height = 600 - margin.top - margin.bottom;

        var zoom = d3.zoom()
          .scaleExtent([0.1, 10]) // 设置缩放的最小和最大比例
          .on("zoom", zoomed); // 当缩放发生时，调用名为 "zoomed" 的函数

        var colorScale = d3.scaleOrdinal(d3.schemeCategory10);
        
        function genrateColor(d){
          var baseColor = colorScale(d.type);
          return d3.interpolateRgb(baseColor, "#fff")(0.5);
        }

        var tip = d3.tip()
          .attr("class", "d3-tip")
          .offset([-10, 0])
          .html(function (d) {
            return "<strong>Title:</strong> <span style='color:white'>" + d.title + "</span><br/>" +
              "<strong>Country:</strong> <span style='color:white'>" + d.country + "</span><br/>" +
              "<strong>Appeared:</strong> <span style='color:white'>" + d.appeared + "</span><br/>" + 
              "<strong>Rank:</strong> <span style='color:white'>" + d.rank + "</span><br/>" +
              "<strong>numberOfUsers:</strong> <span style='color:white'>" + d.numberOfUsers + "</span><br/>" +
              "<strong>Type:</strong> <span style='color:" + colorScale(d.type) + "'>" + d.type + "</span>";
          });
        function scrollToElement(id) {
          const element = document.getElementById(id);
          if (element) {
            element.scrollIntoView({ behavior: 'smooth', block: 'start' });
          }
        }



        document.addEventListener('click', function (e) {
          if (e.target.classList.contains('scroll-link2')) {
            e.preventDefault();

            var targetSectionId = e.target.getAttribute('data-section');
            var targetSection = document.getElementById(targetSectionId);

            if (targetSection) {
              var targetPosition = targetSection.getBoundingClientRect().top + window.pageYOffset - window.innerHeight / 2 + targetSection.clientHeight / 2;

              window.scrollTo({
                top: targetPosition,
                behavior: 'smooth'
              });

              // Add the flash class to the target section
              targetSection.classList.add('flash');

              // Remove the flash class after the animation is completed
              setTimeout(function () {
                targetSection.classList.remove('flash');
              }, 3000); // The duration of the flash animation in milliseconds
            }
          }
        });
        // Initialize the SVG
        var svg = d3.select("#network").append("svg")
          .attr("width", width + margin.left + margin.right)
          .attr("height", height + margin.top + margin.bottom)
          .attr("class", "graph-center") // Add this line to apply the CSS class
          .call(zoom)
          .call(tip)
          .append("g")
          .attr("transform", "translate(" + margin.left + "," + margin.top + ")");
        
        var legend = svg.append("g")
          .attr("class", "legend")
          .attr("transform", "translate(" + (width - 100) + "," + (height - 550) + ")");
          
        // Initialize the force layout
        var simulation = d3.forceSimulation()
          .force("link", d3.forceLink().id(function (d) { return d.title; }).distance(100))
          .force("charge", d3.forceManyBody().strength(-5))
          .force("center", d3.forceCenter(width / 2, height / 2));

        // Create the links
        var link = svg.append("g")
          .attr("class", "links")
          .selectAll("line")
          .data(links_data)
          .enter().append("line")
          .attr("stroke", "#999") // Add this line to set the stroke color
          .attr("stroke-width", function (d) { return Math.sqrt(1); });

        // Create the nodes
        var node = svg.append("g")
          .attr("class", "nodes")
          .selectAll("circle")
          .data(nodes_data)
          .enter().append("circle")
          .attr("r", 10)
          .attr("fill", function (d) { return genrateColor(d); })
          .on('click', function (d) {
            window.open("#tableId" + d.title, '_self'); // Add this line to make the node clickable
          })
          .on('mouseover', function(d){
            tip.show(d, d3.event.target);
            d3.select(this).attr("fill", colorScale(d.type));
          })
          .on('mouseout', function(d){
            tip.hide(d, d3.event.target);
            d3.select(this).attr("fill", genrateColor(d));
          })
          .call(d3.drag()
          .on("start", dragstarted)
          .on("drag", dragged)
          .on("end", dragended));

        types.forEach(function (type, i) {
          legend.append("rect")
            .attr("x", 0)
            .attr("y", i * 25)
            .attr("width", 20)
            .attr("height", 20)
            .style("fill", colorScale(type));

          legend.append("text")
            .attr("x", 25)
            .attr("y", i * 25 + 15)
            .text(type)
            .attr("font-family", "sans-serif")
            .attr("font-size", "12px");
        });


        // Set the nodes and links in the simulation
        simulation
          .nodes(nodes_data)
          .on("tick", ticked);

        simulation.force("link")
          .links(links_data);

        // Update the positions of the nodes and links
        function ticked() {
          link
            .attr("x1", function (d) { return d.source.x; })
            .attr("y1", function (d) { return d.source.y; })
            .attr("x2", function (d) { return d.target.x; })
            .attr("y2", function (d) { return d.target.y; });

          node
            .attr("cx", function (d) { return d.x; })
            .attr("cy", function (d) { return d.y; });
        }

        // Define the drag behavior functions
        function dragstarted(d) {
          if (!d3.event.active) simulation.alphaTarget(0.3).restart();
          d.fx = d.x;
          d.fy = d.y;
        }

        function dragged(d) {
          d.fx = d3.event.x;
          d.fy = d3.event.y;
        }

        function dragended(d) {
          if (!d3.event.active) simulation.alphaTarget(0);
          d.fx = null;
          d.fy = null;
        }
        function zoomed() {
          console.log(d3.event.transform)
          svg.attr("transform", d3.event.transform);
        }
      }
    </script>
    </div>
  </section>



  <!--
  <div class="separator-line"></div>


  <div class="heading text-center">
    <h2>Table of Details</h2>
    <p>
      
    </p>
  </div>
  <div class="heading text-center">
    <button id="toggle-section">Show Details of the Programming Languages</button>
  </div>
  <section id="hidden-table">
    
    
    <table id="languages">
      <thead>
        <tr>
          <th>Title</th>
          <th>Appeared</th>
          <th>Type</th>
          <th>Rank</th>
          <th>Country</th>
          <th>Wikipedia Summary</th>
          <th>BookCount</th>
          <th>paperCount</th>
          <th>GithubRepo Stars</th>
        </tr>
      </thead>
      <tbody>

      </tbody>
    </table>
    <script src="https://code.jquery.com/jquery-3.5.1.js"></script>
<script src="https://cdn.datatables.net/1.10.25/js/jquery.dataTables.min.js"></script>

<script>
  var jQ351 = $.noConflict(true);
  // Now jQ351 is an alias to jQuery 3.5.1
</script>

<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.25/css/jquery.dataTables.min.css">

<script>
  document.addEventListener('DOMContentLoaded', loadData);

  async function loadData() {
    // Replace with the path to your JSON file or API endpoint
    const url = './data/details_data.json';

    try {
      const response = await fetch(url);
      const data = await response.json();
      const tableBody = document.querySelector('#languages tbody');

      data.forEach(row => {
        const tr = document.createElement('tr');

        tr.innerHTML = `
            <td id="tableId${row.id}">${row.title}</td>
            <td>${row.appeared}</td>
            <td>${row.type}</td>
            <td>${row.rank}</td>
            <td>${row.country}</td>
            <td>${row.wikipedia_summary}</td>
            <td>${row.bookCount}</td>
            <td>${row.paperCount}</td>
            <td>${row.githubRepo_stars}</td>
        `;

        tableBody.appendChild(tr);
      });

      // Initialize DataTables after adding all data to the table.
      jQ351('#languages').DataTable({
        "ordering": false // this disables sorting
      });

    } catch (error) {
      console.error('Error fetching data:', error);
    }
  }
</script>

  </section>

  <script>
    document.getElementById('toggle-section').addEventListener('click', function () {
      const section = document.getElementById('hidden-table');
      section.classList.toggle('hidden');
    });
  

  </script>
  -->

  <a href="#top" class="topHome"><i class="fa fa-chevron-up fa-2x"></i></a>

  <!--[if lte IE 8]><script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script><![endif]-->
  <script src="js/modernizr-latest.js"></script>
  <script src="js/jquery-1.8.2.min.js" type="text/javascript"></script>
  <script src="js/bootstrap.min.js" type="text/javascript"></script>
  <script src="js/jquery.isotope.min.js" type="text/javascript"></script>
  <script src="js/fancybox/jquery.fancybox.pack.js" type="text/javascript"></script>
  <script src="js/jquery.nav.js" type="text/javascript"></script>
  <script src="js/jquery.fittext.js"></script>
  <script src="js/waypoints.js"></script>
  <script src="flexslider/jquery.flexslider.js"></script>
  <script src="js/custom.js" type="text/javascript"></script>
  <script src="js/owl-carousel/owl.carousel.js"></script>
</body>

</html>